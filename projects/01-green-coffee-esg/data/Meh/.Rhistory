# 5. Gráficos ejecutivos
# ------------------------------------------------------------
# Tendencia de producción
trend_plot <- coffee %>%
ggplot(aes(x = year, y = production_tonnes, color = country)) +
geom_line(size = 1.2) +
labs(
title = "Brasil domina la producción mundial de café",
x = "Año",
y = "Producción (toneladas)"
) +
theme_minimal() +
theme(legend.position = "bottom")
ggsave("C:/Users/juanp/Documents/Meh/outputs/figures/production_trends.png", trend_plot, width = 8, height = 5)
# Ranking promedio últimos 5 años
ranking <- coffee %>%
filter(year >= max(year) - 4) %>%
group_by(country) %>%
summarise(avg_prod = mean(production_tonnes, na.rm = TRUE)) %>%
arrange(desc(avg_prod))
ranking_plot <- ggplot(ranking, aes(x = reorder(country, avg_prod), y = avg_prod)) +
geom_bar(stat = "identity", fill = "#2C7BB6") +
coord_flip() +
labs(
title = "Top países productores de café (promedio últimos 5 años)",
x = "País",
y = "Producción promedio (toneladas)"
) +
theme_minimal()
ggsave("C:/Users/juanp/Documents/Meh/outputs/figures/production_ranking.png", ranking_plot, width = 8, height = 5)
# ============================================================
# Fin del pipeline
# ============================================================
# ============================================================
# Coffee ESG Pipeline (versión corregida con linewidth)
# ============================================================
library(readr)
library(dplyr)
library(tidyr)
library(scales)
library(ggplot2)
# ------------------------------------------------------------
# 0. Crear carpetas si no existen
# ------------------------------------------------------------
dir.create("C:/Users/juanp/Documents/Meh/data/processed", recursive = TRUE, showWarnings = FALSE)
dir.create("C:/Users/juanp/Documents/Meh/outputs/figures", recursive = TRUE, showWarnings = FALSE)
# ------------------------------------------------------------
# 1. FAOSTAT (producción de café)
# ------------------------------------------------------------
coffee <- read_csv("C:/Users/juanp/Documents/Meh/REPO 1/FAOSTAT.csv") %>%
select(country = Area, year = Year, production_tonnes = Value) %>%
filter(country %in% c("Brazil","Colombia","Peru","Honduras"))
write_csv(coffee, "C:/Users/juanp/Documents/Meh/data/processed/coffee_clean.csv")
# ------------------------------------------------------------
# 2. World Bank datasets (skip = 4 siempre)
# ------------------------------------------------------------
# Pobreza rural (Employment in agriculture %)
poverty <- read_csv("C:/Users/juanp/Documents/Meh/REPO 1/POVERTY/API_SL.AGR.EMPL.ZS_DS2_en_csv_v2_135.csv", skip = 4)
poverty_clean <- poverty %>%
pivot_longer(cols = `1960`:`2020`, names_to = "year", values_to = "poverty_rate") %>%
mutate(year = as.integer(year)) %>%
filter(`Country Name` %in% c("Brazil","Colombia","Peru","Honduras")) %>%
select(country = `Country Name`, year, poverty_rate)
write_csv(poverty_clean, "C:/Users/juanp/Documents/Meh/data/processed/poverty_clean.csv")
# Población rural (growth %)
rural <- read_csv("C:/Users/juanp/Documents/Meh/REPO 1/RURAL/API_SP.RUR.TOTL.ZG_DS2_en_csv_v2_725.csv", skip = 4)
rural_clean <- rural %>%
pivot_longer(cols = `1960`:`2020`, names_to = "year", values_to = "rural_growth") %>%
mutate(year = as.integer(year)) %>%
filter(`Country Name` %in% c("Brazil","Colombia","Peru","Honduras")) %>%
select(country = `Country Name`, year, rural_growth)
write_csv(rural_clean, "C:/Users/juanp/Documents/Meh/data/processed/rural_clean.csv")
# GDP per capita
gdp <- read_csv("C:/Users/juanp/Documents/Meh/REPO 1/GDP/API_NE.GDI.TOTL.ZS_DS2_en_csv_v2_2220.csv", skip = 4)
gdp_clean <- gdp %>%
pivot_longer(cols = `1960`:`2020`, names_to = "year", values_to = "gdp_per_capita") %>%
mutate(year = as.integer(year)) %>%
filter(`Country Name` %in% c("Brazil","Colombia","Peru","Honduras")) %>%
select(country = `Country Name`, year, gdp_per_capita)
write_csv(gdp_clean, "C:/Users/juanp/Documents/Meh/data/processed/gdp_clean.csv")
# ------------------------------------------------------------
# 3. Merge datasets en un maestro
# ------------------------------------------------------------
full_data <- coffee %>%
left_join(poverty_clean, by = c("country","year")) %>%
left_join(rural_clean, by = c("country","year")) %>%
left_join(gdp_clean, by = c("country","year"))
write_csv(full_data, "C:/Users/juanp/Documents/Meh/data/processed/full_data.csv")
# ------------------------------------------------------------
# 4. Crear sub-score ESG (ejemplo simple)
# ------------------------------------------------------------
esg_score <- full_data %>%
group_by(country) %>%
summarise(
prod_norm = rescale(mean(production_tonnes, na.rm=TRUE)),
pov_norm  = rescale(mean(poverty_rate, na.rm=TRUE)),
rur_norm  = rescale(mean(rural_growth, na.rm=TRUE)),
gdp_norm  = rescale(mean(gdp_per_capita, na.rm=TRUE))
) %>%
mutate(esg_score = (prod_norm*0.4 + (1-pov_norm)*0.3 + (1-rur_norm)*0.2 + gdp_norm*0.1))
write_csv(esg_score, "C:/Users/juanp/Documents/Meh/data/processed/esg_score.csv")
# ------------------------------------------------------------
# 5. Gráficos ejecutivos
# ------------------------------------------------------------
# Tendencia de producción
trend_plot <- coffee %>%
ggplot(aes(x = year, y = production_tonnes, color = country)) +
geom_line(linewidth = 1.2) +   # corregido
labs(
title = "Brasil domina la producción mundial de café",
x = "Año",
y = "Producción (toneladas)"
) +
theme_minimal() +
theme(legend.position = "bottom")
ggsave("C:/Users/juanp/Documents/Meh/outputs/figures/production_trends.png", trend_plot, width = 8, height = 5)
# Ranking promedio últimos 5 años
ranking <- coffee %>%
filter(year >= max(year) - 4) %>%
group_by(country) %>%
summarise(avg_prod = mean(production_tonnes, na.rm = TRUE)) %>%
arrange(desc(avg_prod))
ranking_plot <- ggplot(ranking, aes(x = reorder(country, avg_prod), y = avg_prod)) +
geom_bar(stat = "identity", fill = "#2C7BB6") +
coord_flip() +
labs(
title = "Top países productores de café (promedio últimos 5 años)",
x = "País",
y = "Producción promedio (toneladas)"
) +
theme_minimal()
ggsave("C:/Users/juanp/Documents/Meh/outputs/figures/production_ranking.png", ranking_plot, width = 8, height = 5)
# ============================================================
# Fin del pipeline
# ============================================================
# Executive Summary — Coffee ESG Analysis
## Key Findings
- **Brasil domina la producción mundial de café** → concentra el suministro, lo que aumenta el riesgo ante shocks climáticos o regulatorios.
dir.create("C:/Users/juanp/Documents/Meh/data/processed", recursive = TRUE, showWarnings = FALSE)
dir.create("C:/Users/juanp/Documents/Meh/outputs/figures", recursive = TRUE, showWarnings = FALSE)
dir.create("C:/Users/juanp/Documents/Meh/reports", recursive = TRUE, showWarnings = FALSE)
write_csv(coffee, "C:/Users/juanp/Documents/Meh/data/processed/coffee_clean.csv")
write_csv(full_data, "C:/Users/juanp/Documents/Meh/data/processed/full_data.csv")
write_csv(esg_score, "C:/Users/juanp/Documents/Meh/data/processed/esg_score.csv")
summary_text <- "
# Executive Summary — Coffee ESG Analysis
## Key Findings
- Brasil domina la producción mundial de café → riesgo de concentración.
- Colombia balancea volumen y resiliencia.
- Perú y Honduras muestran vulnerabilidad social.
## Recommendation
Diversificar sourcing, evitar >60% en Brasil, integrar Colombia y apoyar programas ESG en Perú/Honduras.
"
writeLines(summary_text, "C:/Users/juanp/Documents/Meh/reports/executive_summary.md")
# ============================================================
# Coffee ESG Pipeline — Full Script
# ============================================================
library(readr)
library(dplyr)
library(tidyr)
library(scales)
library(ggplot2)
# ------------------------------------------------------------
# 0. Crear carpetas si no existen
# ------------------------------------------------------------
dir.create("C:/Users/juanp/Documents/Meh/data/processed", recursive = TRUE, showWarnings = FALSE)
dir.create("C:/Users/juanp/Documents/Meh/outputs/figures", recursive = TRUE, showWarnings = FALSE)
dir.create("C:/Users/juanp/Documents/Meh/reports", recursive = TRUE, showWarnings = FALSE)
# ------------------------------------------------------------
# 1. FAOSTAT (producción de café)
# ------------------------------------------------------------
coffee <- read_csv("C:/Users/juanp/Documents/Meh/REPO 1/FAOSTAT.csv") %>%
select(country = Area, year = Year, production_tonnes = Value) %>%
filter(country %in% c("Brazil","Colombia","Peru","Honduras"))
write_csv(coffee, "C:/Users/juanp/Documents/Meh/data/processed/coffee_clean.csv")
# ------------------------------------------------------------
# 2. World Bank datasets (skip = 4 siempre)
# ------------------------------------------------------------
# Pobreza rural (Employment in agriculture %)
poverty <- read_csv("C:/Users/juanp/Documents/Meh/REPO 1/POVERTY/API_SL.AGR.EMPL.ZS_DS2_en_csv_v2_135.csv", skip = 4)
poverty_clean <- poverty %>%
pivot_longer(cols = `1960`:`2020`, names_to = "year", values_to = "poverty_rate") %>%
mutate(year = as.integer(year)) %>%
filter(`Country Name` %in% c("Brazil","Colombia","Peru","Honduras")) %>%
select(country = `Country Name`, year, poverty_rate)
write_csv(poverty_clean, "C:/Users/juanp/Documents/Meh/data/processed/poverty_clean.csv")
# Población rural (growth %)
rural <- read_csv("C:/Users/juanp/Documents/Meh/REPO 1/RURAL/API_SP.RUR.TOTL.ZG_DS2_en_csv_v2_725.csv", skip = 4)
rural_clean <- rural %>%
pivot_longer(cols = `1960`:`2020`, names_to = "year", values_to = "rural_growth") %>%
mutate(year = as.integer(year)) %>%
filter(`Country Name` %in% c("Brazil","Colombia","Peru","Honduras")) %>%
select(country = `Country Name`, year, rural_growth)
write_csv(rural_clean, "C:/Users/juanp/Documents/Meh/data/processed/rural_clean.csv")
# GDP per capita
gdp <- read_csv("C:/Users/juanp/Documents/Meh/REPO 1/GDP/API_NE.GDI.TOTL.ZS_DS2_en_csv_v2_2220.csv", skip = 4)
gdp_clean <- gdp %>%
pivot_longer(cols = `1960`:`2020`, names_to = "year", values_to = "gdp_per_capita") %>%
mutate(year = as.integer(year)) %>%
filter(`Country Name` %in% c("Brazil","Colombia","Peru","Honduras")) %>%
select(country = `Country Name`, year, gdp_per_capita)
write_csv(gdp_clean, "C:/Users/juanp/Documents/Meh/data/processed/gdp_clean.csv")
# ------------------------------------------------------------
# 3. Merge datasets en un maestro
# ------------------------------------------------------------
full_data <- coffee %>%
left_join(poverty_clean, by = c("country","year")) %>%
left_join(rural_clean, by = c("country","year")) %>%
left_join(gdp_clean, by = c("country","year"))
write_csv(full_data, "C:/Users/juanp/Documents/Meh/data/processed/full_data.csv")
# ------------------------------------------------------------
# 4. Crear sub-score ESG (ejemplo simple)
# ------------------------------------------------------------
esg_score <- full_data %>%
group_by(country) %>%
summarise(
prod_norm = rescale(mean(production_tonnes, na.rm=TRUE)),
pov_norm  = rescale(mean(poverty_rate, na.rm=TRUE)),
rur_norm  = rescale(mean(rural_growth, na.rm=TRUE)),
gdp_norm  = rescale(mean(gdp_per_capita, na.rm=TRUE))
) %>%
mutate(esg_score = (prod_norm*0.4 + (1-pov_norm)*0.3 + (1-rur_norm)*0.2 + gdp_norm*0.1))
write_csv(esg_score, "C:/Users/juanp/Documents/Meh/data/processed/esg_score.csv")
# ------------------------------------------------------------
# 5. Gráficos ejecutivos
# ------------------------------------------------------------
# Tendencia de producción
trend_plot <- coffee %>%
ggplot(aes(x = year, y = production_tonnes, color = country)) +
geom_line(linewidth = 1.2) +
labs(
title = "Brasil domina la producción mundial de café",
x = "Año",
y = "Producción (toneladas)"
) +
theme_minimal() +
theme(legend.position = "bottom")
ggsave("C:/Users/juanp/Documents/Meh/outputs/figures/production_trends.png", trend_plot, width = 8, height = 5)
# Ranking promedio últimos 5 años
ranking <- coffee %>%
filter(year >= max(year) - 4) %>%
group_by(country) %>%
summarise(avg_prod = mean(production_tonnes, na.rm = TRUE)) %>%
arrange(desc(avg_prod))
ranking_plot <- ggplot(ranking, aes(x = reorder(country, avg_prod), y = avg_prod)) +
geom_bar(stat = "identity", fill = "#2C7BB6") +
coord_flip() +
labs(
title = "Top países productores de café (promedio últimos 5 años)",
x = "País",
y = "Producción promedio (toneladas)"
) +
theme_minimal()
ggsave("C:/Users/juanp/Documents/Meh/outputs/figures/production_ranking.png", ranking_plot, width = 8, height = 5)
# ------------------------------------------------------------
# 6. Executive Summary automático
# ------------------------------------------------------------
summary_text <- "
# Executive Summary — Coffee ESG Analysis
## Key Findings
- Brasil domina la producción mundial de café → riesgo de concentración.
- Colombia balancea volumen y resiliencia.
- Perú y Honduras muestran vulnerabilidad social.
## Strategic Implications
- Concentración en Brasil implica riesgo de disrupción.
- Integrar Colombia aporta estabilidad y reputación.
- Incluir Perú y Honduras diversifica riesgos pero requiere programas ESG.
## Recommendation
Diversificar sourcing, evitar >60% en Brasil, integrar Colombia y apoyar programas ESG en Perú/Honduras.
"
writeLines(summary_text, "C:/Users/juanp/Documents/Meh/reports/executive_summary.md")
# ============================================================
# Fin del pipeline
# ============================================================
library(dplyr)
library(ggplot2)
# Suponemos que ya tienes el dataset coffee_clean con columnas:
# country, year, production_tonnes
# 1. Calcular promedio de producción últimos 5 años
ranking <- coffee %>%
filter(year >= max(year) - 4) %>%   # últimos 5 años
group_by(country) %>%
summarise(avg_prod = mean(production_tonnes, na.rm = TRUE)) %>%
arrange(desc(avg_prod))
# 2. Gráfico de barras horizontales
ranking_plot <- ggplot(ranking, aes(x = reorder(country, avg_prod), y = avg_prod)) +
geom_bar(stat = "identity", fill = "#2C7BB6") +
coord_flip() +
labs(
title = "Top países productores de café (promedio últimos 5 años)",
x = "País",
y = "Producción promedio (toneladas)"
) +
theme_minimal()
# 3. Guardar gráfico como PNG
ggsave("C:/Users/juanp/Documents/Meh/outputs/figures/production_ranking.png",
ranking_plot, width = 8, height = 5)
# ============================================================
# Coffee ESG Pipeline — Full Script
# ============================================================
library(readr)
library(dplyr)
library(tidyr)
library(scales)
library(ggplot2)
# ------------------------------------------------------------
# 0. Crear carpetas si no existen
# ------------------------------------------------------------
dir.create("C:/Users/juanp/Documents/Meh/data/processed", recursive = TRUE, showWarnings = FALSE)
dir.create("C:/Users/juanp/Documents/Meh/outputs/figures", recursive = TRUE, showWarnings = FALSE)
dir.create("C:/Users/juanp/Documents/Meh/reports", recursive = TRUE, showWarnings = FALSE)
# ------------------------------------------------------------
# 1. FAOSTAT (producción de café)
# ------------------------------------------------------------
coffee <- read_csv("C:/Users/juanp/Documents/Meh/REPO 1/FAOSTAT.csv") %>%
select(country = Area, year = Year, production_tonnes = Value) %>%
filter(country %in% c("Brazil","Colombia","Peru","Honduras"))
write_csv(coffee, "C:/Users/juanp/Documents/Meh/data/processed/coffee_clean.csv")
# ------------------------------------------------------------
# 2. World Bank datasets (skip = 4 siempre)
# ------------------------------------------------------------
# Pobreza rural (Employment in agriculture %)
poverty <- read_csv("C:/Users/juanp/Documents/Meh/REPO 1/POVERTY/API_SL.AGR.EMPL.ZS_DS2_en_csv_v2_135.csv", skip = 4)
poverty_clean <- poverty %>%
pivot_longer(cols = `1960`:`2020`, names_to = "year", values_to = "poverty_rate") %>%
mutate(year = as.integer(year)) %>%
filter(`Country Name` %in% c("Brazil","Colombia","Peru","Honduras")) %>%
select(country = `Country Name`, year, poverty_rate)
write_csv(poverty_clean, "C:/Users/juanp/Documents/Meh/data/processed/poverty_clean.csv")
# Población rural (growth %)
rural <- read_csv("C:/Users/juanp/Documents/Meh/REPO 1/RURAL/API_SP.RUR.TOTL.ZG_DS2_en_csv_v2_725.csv", skip = 4)
rural_clean <- rural %>%
pivot_longer(cols = `1960`:`2020`, names_to = "year", values_to = "rural_growth") %>%
mutate(year = as.integer(year)) %>%
filter(`Country Name` %in% c("Brazil","Colombia","Peru","Honduras")) %>%
select(country = `Country Name`, year, rural_growth)
write_csv(rural_clean, "C:/Users/juanp/Documents/Meh/data/processed/rural_clean.csv")
# GDP per capita
gdp <- read_csv("C:/Users/juanp/Documents/Meh/REPO 1/GDP/API_NE.GDI.TOTL.ZS_DS2_en_csv_v2_2220.csv", skip = 4)
gdp_clean <- gdp %>%
pivot_longer(cols = `1960`:`2020`, names_to = "year", values_to = "gdp_per_capita") %>%
mutate(year = as.integer(year)) %>%
filter(`Country Name` %in% c("Brazil","Colombia","Peru","Honduras")) %>%
select(country = `Country Name`, year, gdp_per_capita)
write_csv(gdp_clean, "C:/Users/juanp/Documents/Meh/data/processed/gdp_clean.csv")
# ------------------------------------------------------------
# 3. Merge datasets en un maestro
# ------------------------------------------------------------
full_data <- coffee %>%
left_join(poverty_clean, by = c("country","year")) %>%
left_join(rural_clean, by = c("country","year")) %>%
left_join(gdp_clean, by = c("country","year"))
write_csv(full_data, "C:/Users/juanp/Documents/Meh/data/processed/full_data.csv")
# ------------------------------------------------------------
# 4. Crear sub-score ESG (ejemplo simple)
# ------------------------------------------------------------
esg_score <- full_data %>%
group_by(country) %>%
summarise(
prod_norm = rescale(mean(production_tonnes, na.rm=TRUE)),
pov_norm  = rescale(mean(poverty_rate, na.rm=TRUE)),
rur_norm  = rescale(mean(rural_growth, na.rm=TRUE)),
gdp_norm  = rescale(mean(gdp_per_capita, na.rm=TRUE))
) %>%
mutate(esg_score = (prod_norm*0.4 + (1-pov_norm)*0.3 + (1-rur_norm)*0.2 + gdp_norm*0.1))
write_csv(esg_score, "C:/Users/juanp/Documents/Meh/data/processed/esg_score.csv")
# ------------------------------------------------------------
# 5. Gráficos ejecutivos estilo consultoría
# ------------------------------------------------------------
theme_ft <- theme_minimal(base_size = 12) +
theme(
plot.title = element_text(face = "bold", size = 14, hjust = 0),
axis.title = element_text(size = 12),
axis.text = element_text(size = 10),
panel.grid.minor = element_blank(),
panel.grid.major.x = element_blank()
)
# Tendencia de producción
trend_plot <- coffee %>%
ggplot(aes(x = year, y = production_tonnes, color = country)) +
geom_line(linewidth = 1.2) +
labs(
title = "Brasil domina la producción mundial de café",
x = "Año",
y = "Producción (toneladas)"
) +
theme_ft +
scale_color_manual(values = c("Brazil"="#1f78b4","Colombia"="#33a02c","Peru"="#ff7f00","Honduras"="#e31a1c"))
ggsave("C:/Users/juanp/Documents/Meh/outputs/figures/production_trends.png", trend_plot, width = 8, height = 5, dpi = 300)
# Ranking promedio últimos 5 años
ranking <- coffee %>%
filter(year >= max(year) - 4) %>%
group_by(country) %>%
summarise(avg_prod = mean(production_tonnes, na.rm = TRUE)) %>%
arrange(desc(avg_prod))
ranking_plot <- ggplot(ranking, aes(x = avg_prod, y = reorder(country, avg_prod))) +
geom_bar(stat = "identity", fill = "#2C7BB6") +
labs(
title = "Top países productores de café (promedio últimos 5 años)",
x = "Producción promedio (toneladas)",
y = "País"
) +
theme_ft
ggsave("C:/Users/juanp/Documents/Meh/outputs/figures/production_ranking.png", ranking_plot, width = 8, height = 5, dpi = 300)
# ------------------------------------------------------------
# 6. Executive Summary automático
# ------------------------------------------------------------
summary_text <- "
# Executive Summary — Coffee ESG Analysis
## Key Findings
- Brasil domina la producción mundial de café → riesgo de concentración.
- Colombia balancea volumen y resiliencia.
- Perú y Honduras muestran vulnerabilidad social.
## Strategic Implications
- Concentración en Brasil implica riesgo de disrupción.
- Integrar Colombia aporta estabilidad y reputación.
- Incluir Perú y Honduras diversifica riesgos pero requiere programas ESG.
## Recommendation
Diversificar sourcing, evitar >60% en Brasil, integrar Colombia y apoyar programas ESG en Perú/Honduras.
"
writeLines(summary_text, "C:/Users/juanp/Documents/Meh/reports/executive_summary.md")
# ============================================================
# Fin del pipeline
# ============================================================
save.image("~/Meh/REPO 1/Repo 1.RData")
save.image("~/Meh/REPO 1/Repo 1.RData")
# ============================================================
# LIBRERÍAS
# ============================================================
library(readr)
library(dplyr)
library(tidyr)
library(scales)
library(ggplot2)
# ------------------------------------------------------------
# 1. CARGA Y LIMPIEZA (Corregida)
# ------------------------------------------------------------
# FAOSTAT - Producción
coffee_data <- read_csv("C:/Users/juanp/Documents/Meh/REPO 1/FAOSTAT.csv") %>%
select(country = Area, year = Year, production_tonnes = Value) %>%
filter(country %in% c("Brazil", "Colombia", "Peru", "Honduras"))
# BANCO MUNDIAL - Social (Proxy de vulnerabilidad)
# Asegúrate de que el skip=4 sea correcto para tus archivos originales
poverty_data <- read_csv("C:/Users/juanp/Documents/Meh/REPO 1/poverty_data.csv", skip = 4) %>%
select(country = `Country Name`, employment_agri_pct = `2021`) %>%
filter(country %in% c("Brazil", "Colombia", "Peru", "Honduras"))
# ============================================================
# LIBRERÍAS
# ============================================================
library(readr)
library(dplyr)
library(tidyr)
library(scales)
library(ggplot2)
# ------------------------------------------------------------
# 1. CARGA Y LIMPIEZA (Corregida)
# ------------------------------------------------------------
# FAOSTAT - Producción
coffee_data <- read_csv("C:/Users/juanp/Documents/Meh/REPO 1/FAOSTAT.csv") %>%
select(country = Area, year = Year, production_tonnes = Value) %>%
filter(country %in% c("Brazil", "Colombia", "Peru", "Honduras"))
# BANCO MUNDIAL - Social (Proxy de vulnerabilidad)
# Asegúrate de que el skip=4 sea correcto para tus archivos originales
poverty_data <- read_csv("C:/Users/juanp/Documents/Meh/REPO 1/poverty_data.csv", skip = 4) %>%
select(country = `Country Name`, employment_agri_pct = `2021`) %>%
filter(country %in% c("Brazil", "Colombia", "Peru", "Honduras"))
# ============================================================
# LIBRERÍAS
# ============================================================
library(readr)
library(dplyr)
library(tidyr)
library(scales)
library(ggplot2)
# ------------------------------------------------------------
# 1. CARGA DE DATOS (Rutas reales según tu CMD)
# ------------------------------------------------------------
# A. FAOSTAT - Producción (Esta sí funcionó)
coffee_data <- read_csv("C:/Users/juanp/Documents/Meh/REPO 1/FAOSTAT.csv") %>%
select(country = Area, year = Year, production_tonnes = Value) %>%
filter(country %in% c("Brazil", "Colombia", "Peru", "Honduras"))
# B. BANCO MUNDIAL - Social (Aquí estaba el error)
# Usamos la ruta exacta que mostró tu comando DIR /S /B
path_pobreza <- "C:/Users/juanp/Documents/Meh/REPO 1/POVERTY/API_SL.AGR.EMPL.ZS_DS2_en_csv_v2_135.csv"
poverty_data <- read_csv(path_pobreza, skip = 4) %>%
select(country = `Country Name`, employment_agri_pct = `2021`) %>%
filter(country %in% c("Brazil", "Colombia", "Peru", "Honduras"))
# C. BANCO MUNDIAL - Inversión (Extraído de tu carpeta GDP)
path_gdp <- "C:/Users/juanp/Documents/Meh/REPO 1/GDP/API_NE.GDI.TOTL.ZS_DS2_en_csv_v2_2220.csv"
gdp_data <- read_csv(path_gdp, skip = 4) %>%
select(country = `Country Name`, investment_pct_gdp = `2021`) %>%
filter(country %in% c("Brazil", "Colombia", "Peru", "Honduras"))
# ------------------------------------------------------------
# 2. PROCESAMIENTO (Unir todo)
# ------------------------------------------------------------
# Función para normalizar de 0 a 1 (reemplaza 'rescales' si no carga)
norm_01 <- function(x) { (x - min(x, na.rm=T)) / (max(x, na.rm=T) - min(x, na.rm=T)) }
esg_analysis <- coffee_data %>%
group_by(country) %>%
summarise(avg_production = mean(production_tonnes, na.rm = TRUE)) %>%
left_join(poverty_data, by = "country") %>%
left_join(gdp_data, by = "country") %>%
mutate(
prod_n   = norm_01(avg_production),
social_n = norm_01(employment_agri_pct),
inv_n    = norm_01(investment_pct_gdp),
# Score: 40% Prod, 40% Social (Inverso porque +empleo agri = +riesgo), 20% Inv
esg_score = (prod_n * 0.4) + ((1 - social_n) * 0.4) + (inv_n * 0.2)
)
# Guardar resultados
save(esg_analysis, coffee_data, file = "C:/Users/juanp/Documents/Meh/data/processed/esg_results.RData")
message("¡Pipeline ejecutado con éxito! Datos guardados en data/processed")
